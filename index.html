<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="LCHS Go - Bell Schedule App" />
    <link rel="apple-touch-icon" href="/public/faviconAppIcon.png" />
    <meta name="theme-color" content="#333" />
    <link rel="manifest" href="/public/manifest.json" />
    <link rel="stylesheet" href="/public/style.css" />
    <link href="https://fonts.googleapis.com/css?family=Niramit:300,regular,500,600" rel="stylesheet" />
    <script src="https://unpkg.com/petite-vue@0.2.2/dist/petite-vue.iife.js" defer></script>
    <script src="https://unpkg.com/dayjs@1.10.8/dayjs.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.8/plugin/isBetween.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.8/plugin/advancedFormat.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.8/plugin/customParseFormat.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.8/plugin/localeData.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.8/plugin/utc.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.8/plugin/timezone.js"></script>
    <script>
      dayjs.extend(window.dayjs_plugin_isBetween);
      dayjs.extend(window.dayjs_plugin_advancedFormat);
      dayjs.extend(window.dayjs_plugin_customParseFormat);
      dayjs.extend(window.dayjs_plugin_localeData);
      dayjs.extend(window.dayjs_plugin_utc);
      dayjs.extend(window.dayjs_plugin_timezone);
    </script>
    <script>
      const welcome = " _    ___   _ _____               \n| |  / __| (_)_   _|__ __ _ _ __  \n| |_| (__  | | | |/ -_) _` | '  \\ \n|____\\___| |_| |_|\\___\\__,_|_|_|_|\n\nhttps://github.com/lchsiteam/lchs-go-new";
      console.log(welcome);

      // Automatically saturate the background based on the background color
      const styledBackgroundVariables = Array.from(document.styleSheets[0].rules[0].style)
        .map((e) => e.replace("--", ""))
        .filter((e) => isFinite(e))
        .map((e) => parseInt(e));
      const classesUsingBackground = Array.from(document.styleSheets[0].rules)
        .map((e) => ({ selector: e.selectorText, number: styledBackgroundVariables.find((v) => e.cssText.includes(`var(--${v})`)) }))
        .filter((e) => e.number);
      const styleTag = `<style>${classesUsingBackground.map((clazz) => `${clazz.selector} {backdrop-filter: saturate(${clazz.number + 100}%);}`).join("\n")}</style>`;
      document.head.insertAdjacentHTML("beforeend", styleTag);
    </script>
    <script type="module" defer src="/src/index.js"></script>
    <title>LCHS Go</title>
  </head>

  <body id="body" v-scope v-effect="startTimer()">
    <!-- Background - Used to do the color -->
    <div class="background" id="background" v-bind:class="{ 'animated': userSettings.THEME_ANIMATION }">
      <div v-for="i in 100" class="emoji" v-bind:style="{ '--i': (userSettings.EMOJI_DISTRIBUTION == 'RANDOM' ? Math.random() * 60 + 's' : (i % 10 - 1) + 's'), left: (userSettings.EMOJI_DISTRIBUTION == 'RANDOM' ? `calc(${Math.random() * 100}vw - 2rem)` : (i - 3 + (i % 2) * 3) + 'vw') }"></div>
    </div>
    <div class="app-container">
      <!-- Navigation - Holds the page buttons -->
      <div class="navigation">
        <button @click="switchPage('now')" class="nav-button" v-bind:class="{'selected': currentPage == Pages.Now}">{{ translate("NOW") }}</button>
        <button @click="switchPage('calendar')" class="nav-button" v-bind:class="{'selected': currentPage == Pages.Calendar}">{{ translate("CALENDAR") }}</button>
        <button @click="switchPage('settings')" class="nav-button" v-bind:class="{'selected': currentPage == Pages.Settings}">{{ translate("SETTINGS") }}</button>
      </div>

      <div id="pages">
        <!-- Loads pages from external files -->
      </div>

      <!-- End of Pages -->
      <div class="credits">
        Made with ❤️ by the <a href="https://lciteam.club" class="credits" target="_blank">LC iTeam</a>
        <br />
        <a href="https://forms.gle/BgFW4MgL9RGpezdw7" class="credits" target="_blank">Report a bug</a>
        <br />
        <a href="https://chrome.google.com/webstore/detail/lchs-go-beta/bddnpkadgjcbafnmbampfbaiijafealk" class="credits" target="_blank">Install the Extension</a>
      </div>
    </div>

    <!-- Service Worker Startup -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/serviceWorker.js", { scope: "/" }).then(function (registration) {
          // idk what to put here but it is needed for a pwa
        });
        navigator.serviceWorker.ready.then(function (registration) {});
      }
    </script>
  </body>
</html>
